%%{init: {"theme": "base", "themeVariables": {"primaryColor": "#ffffff", "primaryTextColor": "#1a202c", "primaryBorderColor": "#2d3748", "lineColor": "#2d3748", "fontFamily": "Arial, sans-serif", "fontSize": "16px"}, "flowchart": {"curve": "linear"}}}%%
flowchart TD
    %% USER INTERFACE LAYER
    subgraph UI[" üë§ USER INTERFACE LAYER "]
        direction TB
        UserCode["üìù User Code<br/>@agent decorators"]
        API["üîå Praval API"]
        Examples["üìö Examples"]
        
        UserCode --> API
        Examples --> API
    end

    %% CORE FRAMEWORK LAYER
    subgraph CORE[" ‚öôÔ∏è CORE FRAMEWORK LAYER "]
        direction TB
        
        %% Agent System
        AgentClass["ü§ñ Agent Class"]
        Decorator["üé≠ Agent Decorator"] 
        Registry["üìã Agent Registry"]
        
        %% Communication System
        Reef["ü™∏ Reef Network"]
        Spore["üíä Spore Messages"]
        Channels["üì° Reef Channels"]
        
        %% Memory System  
        MemMgr["üß† Memory Manager"]
        STM["‚ö° Short-Term Memory"]
        LTM["üíæ Long-Term Memory"]
        
        %% Storage System
        DataMgr["üíΩ Data Manager"]
        StorageReg["üìÅ Storage Registry"]
    end

    %% LLM PROVIDER LAYER
    subgraph LLM[" ü§ñ LLM PROVIDER LAYER "]
        direction TB
        ProviderFactory["üè≠ Provider Factory"]
        OpenAI["üß† OpenAI Provider"]
        Anthropic["üé≠ Anthropic Provider"]
        Cohere["‚ö° Cohere Provider"]
        
        ProviderFactory --> OpenAI
        ProviderFactory --> Anthropic  
        ProviderFactory --> Cohere
    end

    %% STORAGE PROVIDER LAYER
    subgraph STORAGE[" üóÑÔ∏è STORAGE PROVIDER LAYER "]
        direction TB
        FileSystem["üìÅ FileSystem"]
        PostgreSQL["üêò PostgreSQL"]
        Redis["‚ö° Redis"]
        S3["‚òÅÔ∏è S3"]
        Qdrant["üéØ Qdrant"]
    end

    %% EXTERNAL SERVICES LAYER
    subgraph EXTERNAL[" üåê EXTERNAL SERVICES "]
        direction TB
        OpenAIAPI["üîó OpenAI API"]
        AnthropicAPI["üîó Anthropic API"] 
        CohereAPI["üîó Cohere API"]
        QdrantDB[("üéØ Qdrant DB")]
        PostgresDB[("üêò PostgreSQL")]
        RedisDB[("‚ö° Redis")]
        S3Store[("‚òÅÔ∏è S3 Storage")]
    end

    %% VERTICAL CONNECTIONS BETWEEN LAYERS
    
    %% UI to Core Framework
    API --> Decorator
    API --> AgentClass
    API --> MemMgr
    API --> DataMgr
    
    %% Within Core Framework
    Decorator --> AgentClass
    Decorator --> Registry
    AgentClass --> Reef
    Reef --> Spore
    Reef --> Channels
    MemMgr --> STM
    MemMgr --> LTM
    DataMgr --> StorageReg
    
    %% Core to Providers
    AgentClass --> ProviderFactory
    StorageReg --> FileSystem
    StorageReg --> PostgreSQL
    StorageReg --> Redis
    StorageReg --> S3
    StorageReg --> Qdrant
    LTM --> Qdrant
    
    %% Providers to External Services
    OpenAI --> OpenAIAPI
    Anthropic --> AnthropicAPI
    Cohere --> CohereAPI
    PostgreSQL --> PostgresDB
    Redis --> RedisDB
    S3 --> S3Store
    Qdrant --> QdrantDB
    FileSystem --> S3Store

    %% PROFESSIONAL STYLING
    classDef userLayer fill:#e3f2fd,stroke:#1976d2,stroke-width:3px,color:#0d47a1,font-size:16px
    classDef coreLayer fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px,color:#4a148c,font-size:16px
    classDef providerLayer fill:#e8f5e8,stroke:#388e3c,stroke-width:3px,color:#1b5e20,font-size:16px
    classDef storageLayer fill:#fff3e0,stroke:#f57c00,stroke-width:3px,color:#e65100,font-size:16px
    classDef externalLayer fill:#ffebee,stroke:#d32f2f,stroke-width:3px,color:#b71c1c,font-size:16px
    
    %% Apply styling to layers
    class UI userLayer
    class CORE coreLayer
    class LLM providerLayer
    class STORAGE storageLayer
    class EXTERNAL externalLayer
    
    %% Apply styling to components
    class UserCode,API,Examples userLayer
    class AgentClass,Decorator,Registry,Reef,Spore,Channels,MemMgr,STM,LTM,DataMgr,StorageReg coreLayer
    class ProviderFactory,OpenAI,Anthropic,Cohere providerLayer
    class FileSystem,PostgreSQL,Redis,S3,Qdrant storageLayer
    class OpenAIAPI,AnthropicAPI,CohereAPI,QdrantDB,PostgresDB,RedisDB,S3Store externalLayer